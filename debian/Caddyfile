{
	# Global options block
	# Optional: adjust logging format/level as needed
	# admin off
	log {
		level INFO
	}
}

# Listen on HTTP. In production you can add TLS via Caddy's automatic HTTPS or reverse proxy through your router.
:80 {
	# Serve the dashboard (static files)
	root * /var/www/html
	encode zstd gzip
	file_server

	# Reverse proxy for the Python API under /api/*
	@api path /api/*
	handle @api {
		uri strip_prefix /api
		reverse_proxy 127.0.0.1:5000
	}

	# Reverse proxy for ustreamer under /video/stream
	@stream path /video/stream/*
	handle @stream {
		# Strip the /video/stream prefix so upstream can receive '/?action=stream' or '/stream'
		uri strip_prefix /video/stream
		reverse_proxy 127.0.0.1:8090
	}

	# Simple security headers (tunable)
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy no-referrer
	}
}
